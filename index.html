<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Erotic Date Night</title>
    <meta name="description" content="A sophisticated intimate game for adventurous couples">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Source+Sans+Pro:wght@300;400;600&display=swap" rel="stylesheet">
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="data:application/json,{
        &quot;name&quot;: &quot;Erotic Date Night&quot;,
        &quot;short_name&quot;: &quot;Date Night&quot;,
        &quot;description&quot;: &quot;Sophisticated couples game&quot;,
        &quot;start_url&quot;: &quot;.&quot;,
        &quot;display&quot;: &quot;standalone&quot;,
        &quot;background_color&quot;: &quot;#0a0a0a&quot;,
        &quot;theme_color&quot;: &quot;#d4af37&quot;,
        &quot;icons&quot;: [
            {&quot;src&quot;: &quot;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Crect width='192' height='192' fill='%23d4af37'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='72' fill='%23000'%3Eüî•%3C/text%3E%3C/svg%3E&quot;, &quot;sizes&quot;: &quot;192x192&quot;, &quot;type&quot;: &quot;image/svg+xml&quot;}
        ]
    }">
    
    <style>
        :root {
            --gold: #d4af37;
            --deep-red: #8b0000;
            --burgundy: #722f37;
            --cream: #f5f5dc;
            --black: #0a0a0a;
            --dark-grey: #1a1a1a;
            --medium-grey: #2a2a2a;
            --transparent-gold: rgba(212, 175, 55, 0.1);
            --shadow-gold: 0 0 30px rgba(212, 175, 55, 0.3);
            --shadow-deep: 0 8px 40px rgba(0, 0, 0, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Source Sans Pro', sans-serif;
            background: linear-gradient(135deg, rgba(10, 10, 10, 0.85), rgba(26, 26, 26, 0.85), rgba(114, 47, 55, 0.85)), 
                        url('data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCADIAMgDASIAAhEBAxEB/8QAGwAAAQUBAQAAAAAAAAAAAAAABQABAwQGAgf/xAA5EAABAwMCBAQDBgYCAwEAAAABAAIDBAUREiEGMUFREyJhcTKBkQcUQqGxwRUjUmLR4XLwM4Lx8v/EABcBAQEBAQAAAAAAAAAAAAAAAAABAgP/xAAYEQEBAQEBAAAAAAAAAAAAAAAAARECEv/aAAwDAQACEQMRAD8A') center/cover;
            background-attachment: fixed;
            min-height: 100vh;
            max-height: 100vh;
            color: var(--cream);
            overflow-x: hidden;
            overflow-y: auto;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .container {
            max-width: 420px;
            margin: 0 auto;
            padding: 15px;
            min-height: 100vh;
            max-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-y: auto;
            box-sizing: border-box;
            z-index: 2;
        }

        /* Settings Overlay */
        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease-out;
            transition: opacity 0.3s ease-out;
        }

        .settings-overlay.hidden {
            display: none;
        }

        .settings-modal {
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px;
            max-width: 400px;
            width: 95%;
            max-height: 85vh;
            overflow-y: auto;
            border: 2px solid var(--gold);
            box-shadow: 0 0 50px rgba(212, 175, 55, 0.3), 0 10px 30px rgba(0,0,0,0.8);
            animation: slideUp 0.5s ease-out;
        }

        .settings-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.8rem;
            color: var(--gold);
            text-align: center;
            margin-bottom: 25px;
            text-shadow: 0 0 15px rgba(212, 175, 55, 0.3), 0 2px 4px rgba(0,0,0,0.8);
            font-weight: 400;
        }

        .spice-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 25px;
        }

        .spice-level {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 15px;
            color: var(--cream);
            font-weight: 400;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }

        .spice-level::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .spice-level:hover::before {
            left: 100%;
        }

        .spice-level:hover {
            border-color: var(--gold);
            transform: translateY(-2px);
        }

        .spice-level.selected {
            border-color: var(--gold);
            background: rgba(212, 175, 55, 0.2);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
            transform: scale(1.05);
        }

        .player-names-setup {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .player-input {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid rgba(212, 175, 55, 0.5);
            border-radius: 16px;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            color: var(--cream);
            font-size: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .player-input:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
            background: rgba(0, 0, 0, 0.8);
        }

        .player-input::placeholder {
            color: rgba(245, 245, 220, 0.6);
        }

        .exclusions-title {
            font-size: 1.3rem;
            color: var(--gold);
            margin-bottom: 20px;
            text-align: center;
            font-family: 'Cormorant Garamond', serif;
            font-weight: 400;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.2);
        }

        .exclusion-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .exclusion-item:hover {
            background: rgba(212, 175, 55, 0.1);
            border-color: rgba(212, 175, 55, 0.4);
        }

        .exclusion-checkbox {
            width: 18px;
            height: 18px;
            accent-color: var(--gold);
            cursor: pointer;
        }

        .exclusion-label {
            flex: 1;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .continue-btn {
            background: linear-gradient(135deg, var(--gold), #f4e4bc);
            color: var(--black);
            border: none;
            border-radius: 20px;
            padding: 18px 35px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(212, 175, 55, 0.3);
        }

        .continue-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }

        .continue-btn:hover::before {
            left: 100%;
        }

        .continue-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(212, 175, 55, 0.5);
            background: linear-gradient(135deg, #f4e4bc, var(--gold));
        }

        /* Main App Styles */
        .header {
            text-align: center;
            margin-bottom: 20px;
            animation: fadeInDown 1s ease-out;
            position: relative;
            z-index: 2;
        }

        .title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 3.2rem;
            font-weight: 400;
            margin-bottom: 5px;
            color: var(--gold);
            text-shadow: 0 0 30px rgba(212, 175, 55, 0.6), 0 2px 4px rgba(0, 0, 0, 0.8);
            letter-spacing: 3px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: rgba(245, 245, 220, 0.8);
            opacity: 1;
            font-style: italic;
            font-weight: 300;
            margin-bottom: 5px;
        }

        .current-settings {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid var(--gold);
            border-radius: 30px;
            padding: 18px 30px;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1rem;
            backdrop-filter: blur(10px);
        }

        /* Main golden button styling */
        .settings-btn {
            background: transparent;
            border: 2px solid var(--gold);
            color: var(--gold);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-left: 15px;
            transition: all 0.3s ease;
            font-weight: 400;
        }

        .settings-btn:hover {
            background: rgba(212, 175, 55, 0.1);
            border-color: #f4e4bc;
            color: #f4e4bc;
            transform: translateY(-1px);
        }

        .player-turn {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 20px 35px;
            text-align: center;
            margin-bottom: 25px;
            border: 2px solid var(--gold);
            position: relative;
        }

        .current-player {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2rem;
            font-weight: 400;
            margin-bottom: 5px;
            color: var(--gold);
            text-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
        }

        .turn-counter {
            font-size: 1rem;
            opacity: 0.8;
            color: rgba(245, 245, 220, 0.8);
        }

        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Spinning Wheel Styles */
        .wheel-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .play-button {
            background: linear-gradient(135deg, #d4af37, #f4e4bc);
            color: #000;
            border: none;
            border-radius: 50%;
            width: 140px;
            height: 140px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 50px rgba(212, 175, 55, 0.8), inset 0 0 20px rgba(0,0,0,0.2);
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }

        .play-button::after {
            content: '';
            position: absolute;
            width: 70%;
            height: 70%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23000"><path d="M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H5zm2 3a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm5 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm5 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2zM7 11a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm5 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm5 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2zM7 16a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm5 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm5 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/></svg>');
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
        }

        .play-button-text {
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: -5px;
            font-family: 'Cormorant Garamond', serif;
            letter-spacing: 0.5px;
            color: var(--black);
        }

        .play-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }

        .play-button:hover::before {
            left: 100%;
        }

        .play-button:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(212, 175, 55, 0.6);
        }

        .play-button:not(:disabled) {
            animation: pulseGlow 2s ease-in-out infinite;
        }

        @keyframes pulseGlow {
            0%, 100% { 
                box-shadow: 0 0 50px rgba(212, 175, 55, 0.8), inset 0 0 20px rgba(0,0,0,0.2);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 70px rgba(212, 175, 55, 1), 0 0 100px rgba(212, 175, 55, 0.5), inset 0 0 20px rgba(0,0,0,0.2);
                transform: scale(1.05);
            }
        }

        .play-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.2);
            animation: none;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
            opacity: 1;
            transition: all 0.3s ease;
            max-width: 380px;
            margin-left: auto;
            margin-right: auto;
        }

        .action-buttons.spinning {
            pointer-events: none;
        }

        .action-btn {
            border: none;
            border-radius: 20px;
            padding: 20px 15px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            min-height: 100px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            transform: scale(1);
        }

        .action-btn.highlighted {
            transform: scale(1.1);
            box-shadow: 0 0 30px var(--gold);
            border: 3px solid var(--gold);
            z-index: 10;
        }

        .action-btn.selected {
            transform: scale(1.3);
            box-shadow: 0 0 40px var(--gold);
            border: 4px solid var(--gold);
            z-index: 20;
            animation: selectedPulse 0.6s ease-out;
        }

        .action-btn.shrinking {
            transform: scale(0.8);
            opacity: 0.7;
            transition: all 0.5s ease;
        }

        @keyframes selectedPulse {
            0% { transform: scale(1.1); }
            50% { transform: scale(1.4); }
            100% { transform: scale(1.3); }
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .action-btn:active {
            transform: translateY(-1px);
        }

        .action-btn.clothing {
            background: linear-gradient(135deg, #ff6b9d, #ff8a80);
        }

        .action-btn.drink {
            background: linear-gradient(135deg, #4fc3f7, #29b6f6);
        }

        .action-btn.shot {
            background: linear-gradient(135deg, #ba68c8, #ab47bc);
        }

        .action-btn.question {
            background: linear-gradient(135deg, var(--gold), #f4e4bc);
            color: var(--black);
        }

        .btn-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto;
            filter: brightness(1.2) drop-shadow(0 2px 4px rgba(0,0,0,0.5));
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
        }

        .btn-icon.clothing {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23d4af37"><path d="M6.5 2c-.1 0-.2 0-.3.1C5.9 2.3 5 3.2 5 4.5V7l1.1 2.2c.2.5.4 1 .4 1.6v8.7c0 1.4 1.1 2.5 2.5 2.5h6c1.4 0 2.5-1.1 2.5-2.5v-8.7c0-.6.2-1.1.4-1.6L19 7V4.5c0-1.3-.9-2.2-1.2-2.4-.1-.1-.2-.1-.3-.1h-2c-1.2 0-2.2.5-3 1-.8-.5-1.8-1-3-1h-2zm0 2h2c.8 0 1.5.3 2 .6V9l-2 2-2-2V4.6c0-.1 0-.2 0-.3V4zm7 0h2v.3c0 .1 0 .2 0 .3V9l-2 2-2-2V4.6c.5-.3 1.2-.6 2-.6z"/></svg>');
        }

        .btn-icon.sip {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23d4af37"><path d="M5 2v6c0 4.97 3.58 9 8 9s8-4.03 8-9V2H5zm14 2v4c0 3.87-2.73 7-6 7s-6-3.13-6-7V4h12zM7 4v4c0 2.76 2.24 5 5 5s5-2.24 5-5V4H7zm-2 16h14v2H5z"/></svg>');
        }

        .btn-icon.shot {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23d4af37"><path d="M8 2v5l4 4v10h2V11l4-4V2H8zm2 2h6v1.5L12 10 8 5.5V4z"/></svg>');
        }

        .btn-icon.question {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23d4af37"><path d="M11.07 12.85c.77-1.39 2.25-2.21 3.11-3.44.91-1.29.4-3.7-2.18-3.7-1.69 0-2.52 1.28-2.87 2.34L6.54 6.96C7.25 4.83 9.18 3 11.99 3c2.35 0 3.96 1.07 4.78 2.41.7 1.15 1.11 3.3.03 4.9-1.2 1.77-2.35 2.31-2.97 3.45-.25.46-.35.76-.35 2.24h-2.89c-.01-.78-.13-2.05.48-3.15zM14 20c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2z"/></svg>');
        }

        .btn-text {
            font-size: 1.1rem;
            text-align: center;
            line-height: 1.2;
            color: var(--cream);
            font-weight: 300;
            font-family: 'Source Sans Pro', sans-serif;
        }

        /* Question Modal Overlay */
        .question-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 996;
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .question-overlay.show {
            display: block;
        }

        .question-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 400px;
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.98), rgba(42, 42, 42, 0.98));
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px 25px;
            border: 2px solid var(--gold);
            box-shadow: 0 0 50px rgba(212, 175, 55, 0.5), 0 10px 30px rgba(0,0,0,0.8);
            display: none;
            animation: questionPop 0.5s ease-out;
            z-index: 997;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes questionPop {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .question-display.show {
            display: block;
        }

        .question-display::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--gold), transparent, var(--gold));
            border-radius: 25px;
            opacity: 0.3;
            z-index: -1;
            animation: shimmerBorder 3s linear infinite;
        }

        @keyframes shimmerBorder {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .question-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            color: var(--gold);
            text-shadow: 0 3px 6px rgba(0,0,0,0.7);
            letter-spacing: 1px;
        }

        .question-text {
            font-size: 1.3rem;
            line-height: 1.5;
            text-align: center;
            font-style: italic;
            margin-bottom: 20px;
            color: var(--cream);
            padding: 0 10px;
        }

        .question-intensity {
            display: inline-block;
            background: var(--gold);
            color: var(--black);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 3px 10px rgba(212, 175, 55, 0.3);
        }

        .question-actions {
            margin-top: 30px;
            animation: fadeInUp 0.5s ease-out 0.3s both;
        }

        .answer-buttons {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            justify-content: center;
        }

        .answer-btn {
            flex: 1;
            max-width: 140px;
            background: none;
            border: 2px solid var(--gold);
            border-radius: 20px;
            padding: 15px 10px;
            color: var(--gold);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .answer-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gold);
            transition: left 0.3s ease;
            z-index: -1;
        }

        .answer-btn:hover::before {
            left: 0;
        }

        .answer-btn:hover {
            color: var(--black);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.4);
        }

        .yes-btn:hover {
            border-color: #4CAF50;
        }

        .yes-btn:hover::before {
            background: #4CAF50;
        }

        .no-btn:hover {
            border-color: #ff4757;
        }

        .no-btn:hover::before {
            background: #ff4757;
        }

        .answer-emoji {
            font-size: 1.5rem;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .answer-text {
            font-size: 0.9rem;
            text-align: center;
            line-height: 1.2;
        }

        .random-choice-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--burgundy), var(--deep-red));
            border: none;
            border-radius: 15px;
            padding: 12px 20px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .random-choice-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .random-choice-btn:hover::before {
            left: 100%;
        }

        .random-choice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 0, 0, 0.4);
        }

        .random-choice-btn.spinning {
            animation: spin 0.8s ease-in-out;
        }

        .random-emoji {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .random-choice-btn:hover .random-emoji {
            transform: rotate(360deg);
        }

        .random-text {
            font-size: 0.9rem;
        }

        .question-result {
            text-align: center;
            padding: 25px;
            margin-top: 20px;
            border-radius: 15px;
            animation: resultSlide 0.6s ease-out;
        }

        .question-result.yes-result {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .question-result.no-result {
            background: rgba(255, 71, 87, 0.1);
            border: 1px solid rgba(255, 71, 87, 0.3);
        }

        .question-result.random-result {
            background: rgba(186, 104, 200, 0.1);
            border: 1px solid rgba(186, 104, 200, 0.3);
        }

        .result-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            animation: bounce 0.6s ease-out;
        }

        .result-message {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--cream);
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            z-index: 1050;
            display: none;
            border: 1px solid var(--gold);
            box-shadow: var(--shadow-deep);
            max-width: 90%;
            text-align: center;
        }

        .notification.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            z-index: 1001;
            display: none;
            border: 1px solid var(--gold);
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(212, 175, 55, 0.3);
            border-radius: 50%;
            border-top-color: var(--gold);
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Auto-advance countdown overlay */
        .auto-advance-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            border: 2px solid var(--gold);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            z-index: 999;
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .auto-advance-overlay.show {
            display: block;
        }

        .countdown-number {
            font-size: 4rem;
            font-weight: bold;
            color: var(--gold);
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
            animation: pulse 1s ease-out infinite;
        }

        .countdown-text {
            margin-top: 10px;
            font-size: 1.2rem;
            color: var(--cream);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateX(-50%) translateY(-10px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes resultSlide {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: scale(1);
            }
            40%, 43% {
                transform: scale(1.1);
            }
            70% {
                transform: scale(1.05);
            }
            90% {
                transform: scale(1.02);
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Settings Section - Hidden by default */
        .settings-section {
            display: none;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .container { 
                padding: 15px; 
            }
            
            .title { 
                font-size: 2.2rem; 
            }
            
            .spice-selector { 
                grid-template-columns: 1fr; 
                gap: 10px;
            }
            
            .spice-level {
                padding: 12px;
                font-size: 0.85rem;
            }
            
            .action-btn { 
                padding: 15px 10px; 
                min-height: 80px; 
            }
            
            .btn-emoji { 
                font-size: 1.5rem; 
            }
            
            .btn-text {
                font-size: 0.8rem;
            }

            .settings-modal {
                padding: 25px;
                margin: 10px;
            }

            .exclusion-item {
                padding: 10px;
                margin-bottom: 8px;
            }

            .play-button {
                width: 120px;
                height: 120px;
            }

            .play-button::after {
                font-size: 3.5rem;
            }

            .play-icon {
                width: 60px;
                height: 60px;
            }

            .question-display {
                width: 95%;
                padding: 20px;
                max-height: 85vh;
            }
        }

        @media (max-width: 360px) {
            .title { 
                font-size: 2rem; 
            }
            
            .action-buttons { 
                gap: 12px; 
            }

            .settings-title {
                font-size: 1.7rem;
            }

            .exclusion-label {
                font-size: 0.85rem;
            }

            .play-button {
                width: 90px;
                height: 90px;
            }

            .play-icon {
                width: 50px;
                height: 50px;
            }

            .question-display {
                padding: 20px 15px;
            }

            .question-title {
                font-size: 1.5rem;
            }

            .question-text {
                font-size: 1.1rem;
            }
        }

        /* Performance optimizations */
        .action-btn, .spice-level, .continue-btn, .play-button {
            will-change: transform;
        }

        /* Accessibility improvements */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Touch improvements for mobile */
        .action-btn, .spice-level, .continue-btn, .settings-btn, .exclusion-item, .play-button {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

    </style>
</head>
<body>
    <!-- Player Setup Overlay -->
    <div class="settings-overlay" id="playerSetupOverlay">
        <div class="settings-modal">
            <h2 class="settings-title">Welcome to Erotic Date Night</h2>
            
            <div style="margin-bottom: 30px; text-align: center;">
                <p style="color: var(--cream); margin-bottom: 25px; font-size: 1.1rem;">Enter your names to get started:</p>
                
                <div class="player-names-setup">
                    <input type="text" class="player-input" id="setupPlayer1Name" placeholder="Player 1 Name" maxlength="20">
                    <input type="text" class="player-input" id="setupPlayer2Name" placeholder="Player 2 Name" maxlength="20">
                </div>
            </div>
            
            <button class="continue-btn" onclick="savePlayerNamesAndContinue()">
                Continue to Game Settings
            </button>
        </div>
    </div>

    <!-- Settings Overlay -->
    <div class="settings-overlay hidden" id="settingsOverlay">
        <div class="settings-modal">
            <h2 class="settings-title">Choose Your Experience</h2>
            
            <div class="spice-selector">
                <div class="spice-level" data-level="1" onclick="selectSpiceLevel(1)">
                    <div style="font-size: 1.2rem;">üòä Romantic</div>
                    <div style="font-size: 0.8rem; margin-top: 5px; opacity: 0.8;">Sensual & Sweet</div>
                </div>
                <div class="spice-level selected" data-level="2" onclick="selectSpiceLevel(2)">
                    <div style="font-size: 1.2rem;">üî• Spicy</div>
                    <div style="font-size: 0.8rem; margin-top: 5px; opacity: 0.8;">Passionate & Bold</div>
                </div>
                <div class="spice-level" data-level="3" onclick="selectSpiceLevel(3)">
                    <div style="font-size: 1.2rem;">üå∂Ô∏è Intense</div>
                    <div style="font-size: 0.8rem; margin-top: 5px; opacity: 0.8;">Kinky & Explicit</div>
                </div>
                <div class="spice-level" data-level="4" onclick="selectSpiceLevel(4)">
                    <div style="font-size: 1.2rem;">üî•üî• Extreme</div>
                    <div style="font-size: 0.8rem; margin-top: 5px; opacity: 0.8;">No Limits</div>
                </div>
            </div>
            
            <div class="exclusions-section">
                <div class="exclusions-title">Exclude These Topics:</div>
                
                <label class="exclusion-item" onclick="toggleExclusion(this)">
                    <input type="checkbox" class="exclusion-checkbox" data-category="bondage">
                    <span class="exclusion-label">üîó Bondage & BDSM</span>
                </label>
                
                <label class="exclusion-item" onclick="toggleExclusion(this)">
                    <input type="checkbox" class="exclusion-checkbox" data-category="public">
                    <span class="exclusion-label">üåç Public Activities</span>
                </label>
                
                <label class="exclusion-item" onclick="toggleExclusion(this)">
                    <input type="checkbox" class="exclusion-checkbox" data-category="roleplay">
                    <span class="exclusion-label">üé≠ Role Playing</span>
                </label>
                
                <label class="exclusion-item" onclick="toggleExclusion(this)">
                    <input type="checkbox" class="exclusion-checkbox" data-category="toys">
                    <span class="exclusion-label">üß∏ Toys & Accessories</span>
                </label>
                
                <label class="exclusion-item" onclick="toggleExclusion(this)">
                    <input type="checkbox" class="exclusion-checkbox" data-category="voyeur">
                    <span class="exclusion-label">üëÄ Watching & Recording</span>
                </label>
                
                <label class="exclusion-item" onclick="toggleExclusion(this)">
                    <input type="checkbox" class="exclusion-checkbox" data-category="taboo" checked>
                    <span class="exclusion-label">üö´ Taboo & Extreme</span>
                </label>
            </div>
            
            <button class="continue-btn" onclick="saveSettingsAndContinue()">
                Start Playing
            </button>
        </div>
    </div>

    <!-- Main App -->
    <div class="container">
        <div class="header">
            <h1 class="title">Erotic Date Night</h1>
            <p class="subtitle">A sophisticated game for adventurous couples</p>
        </div>

        <div class="current-settings" id="currentSettings">
            <span>Current Level: <strong>Spicy</strong></span>
            <button class="settings-btn" onclick="showSettings()">Change</button>
        </div>

        <div class="player-turn">
            <div class="current-player" id="currentPlayerDisplay">Player 1's Turn</div>
            <div class="turn-counter" id="turnCounter">Turn #1</div>
        </div>

        <div class="game-area">
            <!-- Spinning Wheel Section -->
            <div class="wheel-container">
                <button class="play-button" id="playButton" onclick="startSpinning()"></button>
                
                <div class="action-buttons" id="actionButtons">
                    <button class="action-btn" data-action="Remove Clothing" aria-label="Remove piece of clothing">
                        <div class="btn-icon clothing"></div>
                        <span class="btn-text">Remove Clothing</span>
                    </button>
                    
                    <button class="action-btn" data-action="Take a Sip" aria-label="Take a sip of drink">
                        <div class="btn-icon sip"></div>
                        <span class="btn-text">Take a Sip</span>
                    </button>
                    
                    <button class="action-btn" data-action="Take a Shot" aria-label="Take a shot">
                        <div class="btn-icon shot"></div>
                        <span class="btn-text">Take a Shot</span>
                    </button>
                    
                    <button class="action-btn" data-action="Question" aria-label="Answer a spicy question">
                        <div class="btn-icon question"></div>
                        <span class="btn-text">Will You Ever...</span>
                    </button>
                </div>
            </div>

    <!-- Question Display Modal -->
    <div class="question-overlay" id="questionOverlay"></div>
    <div class="question-display" id="questionDisplay">
        <div class="question-title">Will You Ever...</div>
        <div class="question-text" id="questionText"></div>
        <div style="text-align: center; margin-top: 15px;">
            <span class="question-intensity" id="questionIntensity"></span>
        </div>
        
        <div class="question-actions" id="questionActions">
            <div class="answer-buttons">
                <button class="answer-btn yes-btn" onclick="answerQuestion('yes')">
                    <span class="answer-emoji">üíã</span>
                    <span class="answer-text">Hell Yes!</span>
                </button>
                <button class="answer-btn no-btn" onclick="answerQuestion('no')">
                    <span class="answer-emoji">üòà</span>
                    <span class="answer-text">Not Tonight</span>
                </button>
            </div>
            
            <button class="random-choice-btn" id="fateDecideBtn" onclick="letFateDecide()">
                <span class="random-emoji">üé≤</span>
                <span class="random-text">Let Fate Decide</span>
            </button>
        </div>
        
        <div class="question-result" id="questionResult" style="display: none;">
            <div class="result-icon" id="resultIcon"></div>
            <div class="result-message" id="resultMessage"></div>
        </div>
    </div>

    <!-- Auto-advance countdown overlay -->
    <div class="auto-advance-overlay" id="autoAdvanceOverlay">
        <div class="countdown-number" id="countdownNumber">3</div>
        <div class="countdown-text">Next player in...</div>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>Loading...</div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Configuration - REPLACE WITH YOUR ACTUAL GOOGLE APPS SCRIPT WEB APP URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzmH-KMHEc1xqs6PPORu7q5Y1eeA7PfQCuLl0DmZffhhW2maSDxZq_WiEBhjGafgl9T/exec';
        
        // Game State
        let gameState = {
            currentPlayer: 'Player1',
            totalTurns: 0,
            player1Name: 'Player 1',
            player2Name: 'Player 2',
            spiceLevel: 2,
            excludedCategories: ['taboo'],
            sessionID: generateSessionID(),
            isSpinning: false,
            actionTaken: false
        };

        // Spinning wheel state
        let spinningState = {
            currentHighlight: 0,
            isSpinning: false,
            spinSpeed: 150,
            finalSelection: null
        };

        // Action buttons array for spinning
        const actionElements = [];

        // Comprehensive Questions Database (organized by spice level and category)
        const questionsDatabase = {
            1: { // Romantic
                general: [
                    "Will you ever let me give you a sensual massage tonight?",
                    "Will you ever tell me what makes you feel most loved?",
                    "Will you ever dance with me in just our underwear?",
                    "Will you ever let me undress you slowly by candlelight?",
                    "Will you ever let me worship your body with kisses?",
                    "Will you ever write me a love letter describing your desires?"
                ],
                fantasy: [
                    "Will you ever share your most romantic fantasy with me?",
                    "Will you ever tell me about your dream romantic getaway?",
                    "Will you ever describe how you want to be seduced?"
                ]
            },
            2: { // Spicy  
                general: [
                    "Will you ever let me choose what you wear to bed tonight?",
                    "Will you ever try that position we talked about?",
                    "Will you ever tell me your secret turn-on?",
                    "Will you ever let me tease you until you can't take it?",
                    "Will you ever skinny dip with me tonight?",
                    "Will you ever let me wake you up with oral sex?",
                    "Will you ever have sex with me in the shower?",
                    "Will you ever let me see you completely naked in daylight?",
                    "Will you ever tell me what you want me to do to you right now?",
                    "Will you ever try making love without saying a word?"
                ],
                fantasy: [
                    "Will you ever tell me your dirtiest fantasy?",
                    "Will you ever share what you think about when you touch yourself?",
                    "Will you ever describe your perfect night of passion?"
                ],
                voyeur: [
                    "Will you ever let me watch you touch yourself?",
                    "Will you ever show me how you like to be touched?",
                    "Will you ever let me take photos of you in lingerie?",
                    "Will you ever send me a sexy photo when I'm at work?"
                ]
            },
            3: { // Intense
                general: [
                    "Will you ever try anal with me?",
                    "Will you ever let me tease you until you can't take it?",
                    "Will you ever try edging with me?",
                    "Will you ever let me use ice on your body?",
                    "Will you ever let me completely dominate you tonight?"
                ],
                bondage: [
                    "Will you ever let me tie your hands behind your back?",
                    "Will you ever let me blindfold you during foreplay?",
                    "Will you ever let me use handcuffs on you?",
                    "Will you ever try being completely submissive to me?",
                    "Will you ever let me spank you?",
                    "Will you ever let me control when you climax?"
                ],
                public: [
                    "Will you ever let me pleasure you in a public place?",
                    "Will you ever risk getting caught with me?",
                    "Will you ever try having sex in a risky location?",
                    "Will you ever have sex with me while others are nearby?"
                ],
                toys: [
                    "Will you ever use toys with me?",
                    "Will you ever let me control your pleasure with a toy?",
                    "Will you ever experiment with different toys together?"
                ],
                roleplay: [
                    "Will you ever role-play being strangers meeting for the first time?",
                    "Will you ever dress up in costume for me?",
                    "Will you ever pretend to be someone else in bed?"
                ],
                voyeur: [
                    "Will you ever let me record us (just for us)?",
                    "Will you ever moan my name while I watch you?",
                    "Will you ever perform for me like I'm your audience?"
                ]
            },
            4: { // Extreme  
                general: [
                    "Will you ever try something that pushes both our boundaries?",
                    "Will you ever explore your darkest desires with me?"
                ],
                bondage: [
                    "Will you ever try pain mixed with pleasure?",
                    "Will you ever experiment with power exchange scenarios?",
                    "Will you ever let me have complete control over your body?"
                ],
                toys: [
                    "Will you ever try double penetration with toys?",
                    "Will you ever experiment with extreme toys?"
                ],
                taboo: [
                    "Will you ever try taboo role-playing scenarios?",
                    "Will you ever explore forbidden fantasies with me?",
                    "Will you ever let me fulfill your most secret desire?"
                ]
            }
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            loadGameState();
            initializeActionElements();
            
            // Check if players have been set up
            if (!gameState.player1Name || gameState.player1Name === 'Player 1' || 
                !gameState.player2Name || gameState.player2Name === 'Player 2') {
                showPlayerSetup();
            } else if (!localStorage.getItem('eroticDateNightSettings')) {
                showSettings();
            } else {
                updateDisplay();
            }

            // Register service worker for PWA functionality
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('data:text/javascript,// Minimal service worker').catch(() => {
                    // Service worker registration failed - continue without PWA features
                });
            }
        });

        // Initialize action elements array for spinning
        function initializeActionElements() {
            const buttons = document.querySelectorAll('.action-btn');
            actionElements.length = 0; // Clear array
            buttons.forEach(btn => actionElements.push(btn));
        }

        // SPINNING WHEEL FUNCTIONALITY WITH WEIGHTED PROBABILITIES
        // The dice is weighted to land on different actions with these chances:
        // - Will You Ever: 50% of the time (1 in 2)
        // - Take a Sip: 20% of the time (1 in 5)
        // - Remove Clothing: 12.5% of the time (1 in 8)
        // - Take a Shot: 10% of the time (1 in 10)
        // (Percentages normalized to total 100%)
        function startSpinning() {
            if (spinningState.isSpinning || gameState.actionTaken) {
                return;
            }

            spinningState.isSpinning = true;
            gameState.isSpinning = true;
            
            // Disable play button
            const playButton = document.getElementById('playButton');
            playButton.disabled = true;
            playButton.style.opacity = '0.7';
            
            // Add spinning class to action buttons container
            document.getElementById('actionButtons').classList.add('spinning');
            
            // Start the spinning animation
            spinWheel();
        }

        function spinWheel() {
            const totalSpins = 15 + Math.floor(Math.random() * 10); // 15-25 total highlights
            let currentSpin = 0;
            let currentSpeed = 100; // Start fast
            
            function highlightNext() {
                // Remove previous highlight
                actionElements.forEach(btn => btn.classList.remove('highlighted'));
                
                // Highlight current button
                actionElements[spinningState.currentHighlight].classList.add('highlighted');
                
                // Play sound effect (haptic feedback)
                triggerHapticFeedback();
                
                // Move to next button
                spinningState.currentHighlight = (spinningState.currentHighlight + 1) % actionElements.length;
                currentSpin++;
                
                // Slow down as we approach the end
                if (currentSpin > totalSpins * 0.7) {
                    currentSpeed += 50; // Slow down
                }
                
                if (currentSpin < totalSpins) {
                    setTimeout(highlightNext, currentSpeed);
                } else {
                    // Spinning is done, select the final option
                    selectFinalAction();
                }
            }
            
            highlightNext();
        }

        function selectFinalAction() {
            // Remove all highlights
            actionElements.forEach(btn => btn.classList.remove('highlighted'));
            
            // Use weighted random selection instead of the spinning position
            const selectedButton = getWeightedRandomAction();
            
            // Add selected class with animation
            selectedButton.classList.add('selected');
            
            // Trigger strong haptic feedback
            if ('vibrate' in navigator) {
                navigator.vibrate([100, 50, 100]);
            }
            
            // Get the action from the button
            const action = selectedButton.dataset.action;
            spinningState.finalSelection = action;
            
            // Show selection for 2 seconds, then execute
            setTimeout(() => {
                executeSelectedAction(action, selectedButton);
            }, 2000);
        }

        function getWeightedRandomAction() {
            // Define weights based on user requirements:
            // Remove Clothing: 1 in 8 chance (12.5%)
            // Take a Shot: 1 in 10 chance (10%)
            // Take a Sip: 1 in 5 chance (20%)
            // Will You Ever: 1 in 2 chance (50%)
            // Note: These probabilities are normalized to sum to 100%
            
            const weights = {
                'Remove Clothing': 0.125,  // 1/8
                'Take a Shot': 0.10,       // 1/10
                'Take a Sip': 0.20,        // 1/5
                'Question': 0.50           // 1/2 (Will You Ever)
            };
            
            // Normalize weights to ensure they sum to 1
            const totalWeight = Object.values(weights).reduce((a, b) => a + b, 0);
            const normalizedWeights = {};
            for (const [action, weight] of Object.entries(weights)) {
                normalizedWeights[action] = weight / totalWeight;
            }
            
            // Create cumulative weights
            const actions = [];
            const cumulativeWeights = [];
            let cumSum = 0;
            
            for (const [action, weight] of Object.entries(normalizedWeights)) {
                actions.push(action);
                cumSum += weight;
                cumulativeWeights.push(cumSum);
            }
            
            // Generate random number and find corresponding action
            const random = Math.random();
            let selectedAction = actions[0];
            
            for (let i = 0; i < cumulativeWeights.length; i++) {
                if (random <= cumulativeWeights[i]) {
                    selectedAction = actions[i];
                    break;
                }
            }
            
            // Find and return the button element with this action
            const selectedButton = Array.from(actionElements).find(btn => btn.dataset.action === selectedAction);
            
            // Log for debugging (can be removed in production)
            console.log(`Weighted selection: ${selectedAction} (${(normalizedWeights[selectedAction] * 100).toFixed(1)}% chance)`);
            
            return selectedButton;
        }

        function executeSelectedAction(action, buttonElement) {
            // Remove selected class and add shrinking
            buttonElement.classList.remove('selected');
            buttonElement.classList.add('shrinking');
            
            // Mark action as taken
            gameState.actionTaken = true;
            
            const currentPlayerName = gameState.currentPlayer === 'Player1' ? gameState.player1Name : gameState.player2Name;
            
            if (action === 'Question') {
                const question = getFilteredQuestion();
                gameState.currentQuestion = question;
                const levels = {1: 'Romantic', 2: 'Spicy', 3: 'Intense', 4: 'Extreme'};
                
                document.getElementById('questionText').textContent = question;
                document.getElementById('questionIntensity').textContent = levels[gameState.spiceLevel];
                document.getElementById('questionOverlay').classList.add('show');
                document.getElementById('questionDisplay').classList.add('show');
                
                // Show the question actions
                document.getElementById('questionActions').style.display = 'block';
                document.getElementById('questionResult').style.display = 'none';
                
                showNotification(`${currentPlayerName}, answer this ${levels[gameState.spiceLevel].toLowerCase()} question!`);
                
            } else {
                showNotification(`${currentPlayerName} must: ${action}`);
                logAction(currentPlayerName, action);
                
                // Start auto-advance countdown after a delay
                setTimeout(() => {
                    startAutoAdvanceCountdown();
                }, 1500);
            }
            
            // Reset spinning state
            resetSpinningState();
        }

        function resetSpinningState() {
            spinningState.isSpinning = false;
            gameState.isSpinning = false;
            spinningState.currentHighlight = 0;
            
            // Re-enable play button for next turn (will be hidden until next turn)
            const playButton = document.getElementById('playButton');
            playButton.disabled = false;
            playButton.style.opacity = '1';
            
            // Remove spinning class
            document.getElementById('actionButtons').classList.remove('spinning');
            
            // Remove all button states
            actionElements.forEach(btn => {
                btn.classList.remove('highlighted', 'selected', 'shrinking');
            });
        }

        function startAutoAdvanceCountdown() {
            console.log('Starting auto-advance countdown');
            const overlay = document.getElementById('autoAdvanceOverlay');
            const countdownNumber = document.getElementById('countdownNumber');
            
            overlay.classList.add('show');
            let countdown = 3;
            countdownNumber.textContent = countdown;
            
            const countdownInterval = setInterval(() => {
                countdown--;
                console.log('Countdown:', countdown);
                if (countdown > 0) {
                    countdownNumber.textContent = countdown;
                    triggerHapticFeedback();
                } else {
                    clearInterval(countdownInterval);
                    overlay.classList.remove('show');
                    console.log('Advancing to next turn');
                    nextTurn();
                }
            }, 1000);
        }

        // Player Setup Functions
        function showPlayerSetup() {
            document.getElementById('playerSetupOverlay').classList.remove('hidden');
        }

        function savePlayerNamesAndContinue() {
            const player1 = document.getElementById('setupPlayer1Name').value.trim();
            const player2 = document.getElementById('setupPlayer2Name').value.trim();
            
            if (!player1 || !player2) {
                showNotification('Please enter both player names!');
                return;
            }
            
            if (player1.toLowerCase() === player2.toLowerCase()) {
                showNotification('Please use different names!');
                return;
            }
            
            gameState.player1Name = player1;
            gameState.player2Name = player2;
            
            // Hide player setup with a small delay for transition
            document.getElementById('playerSetupOverlay').style.opacity = '0';
            
            setTimeout(() => {
                document.getElementById('playerSetupOverlay').classList.add('hidden');
                document.getElementById('playerSetupOverlay').style.opacity = '1';
                
                // Show settings if not already configured
                if (!localStorage.getItem('eroticDateNightSettings')) {
                    setTimeout(() => {
                        showSettings();
                    }, 200);
                } else {
                    updateDisplay();
                    showNotification(`Welcome ${player1} and ${player2}! Roll the golden dice to play!`);
                }
            }, 300);
            
            saveGameState();
        }

        // Utility Functions
        function generateSessionID() {
            return 'session_' + Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function showLoading(show = true) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.add('show');
            } else {
                loading.classList.remove('show');
            }
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Settings Functions
        function selectSpiceLevel(level) {
            gameState.spiceLevel = level;
            
            // Update visual selection
            document.querySelectorAll('.spice-level').forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelector(`[data-level="${level}"]`).classList.add('selected');
        }

        function toggleExclusion(labelElement) {
            // Prevent double-firing from both label and checkbox
            setTimeout(() => {
                const checkbox = labelElement.querySelector('.exclusion-checkbox');
                if (checkbox) {
                    if (checkbox.checked) {
                        labelElement.style.background = 'rgba(212, 175, 55, 0.15)';
                        labelElement.style.borderColor = 'rgba(212, 175, 55, 0.5)';
                    } else {
                        labelElement.style.background = 'rgba(0, 0, 0, 0.5)';
                        labelElement.style.borderColor = 'rgba(212, 175, 55, 0.2)';
                    }
                }
            }, 10);
        }

        function showSettings() {
            document.getElementById('settingsOverlay').classList.remove('hidden');
            
            // Update current selections
            document.querySelector(`[data-level="${gameState.spiceLevel}"]`).classList.add('selected');
            
            // Update exclusion checkboxes
            gameState.excludedCategories.forEach(category => {
                const checkbox = document.querySelector(`[data-category="${category}"]`);
                if (checkbox) {
                    checkbox.checked = true;
                    const labelElement = checkbox.closest('.exclusion-item');
                    if (labelElement) {
                        labelElement.style.background = 'rgba(212, 175, 55, 0.15)';
                        labelElement.style.borderColor = 'rgba(212, 175, 55, 0.5)';
                    }
                }
            });
        }

        function saveSettingsAndContinue() {
            // Get excluded categories
            const excludedCategories = [];
            document.querySelectorAll('.exclusion-checkbox:checked').forEach(checkbox => {
                excludedCategories.push(checkbox.dataset.category);
            });
            
            gameState.excludedCategories = excludedCategories;
            
            // Save to localStorage
            localStorage.setItem('eroticDateNightSettings', JSON.stringify({
                spiceLevel: gameState.spiceLevel,
                excludedCategories: gameState.excludedCategories
            }));
            
            // Save preferences to backend if connected
            saveUserPreferences();
            
            // Hide overlay and update display
            document.getElementById('settingsOverlay').classList.add('hidden');
            updateCurrentSettingsDisplay();
            updateDisplay();
            
            showNotification('Settings saved! Press Let\'s Play to begin your adventure!');
        }

        function updateCurrentSettingsDisplay() {
            const levels = {1: 'Romantic', 2: 'Spicy', 3: 'Intense', 4: 'Extreme'};
            const levelName = levels[gameState.spiceLevel];
            
            document.getElementById('currentSettings').innerHTML = `
                <span>Current Level: <strong>${levelName}</strong></span>
                <button class="settings-btn" onclick="showSettings()">Change</button>
            `;
        }

        // Game Functions
        function updateDisplay() {
            const currentPlayerName = gameState.currentPlayer === 'Player1' ? gameState.player1Name : gameState.player2Name;
            document.getElementById('currentPlayerDisplay').textContent = currentPlayerName + "'s Turn";
            document.getElementById('turnCounter').textContent = `Turn #${gameState.totalTurns + 1}`;
            
            // Hide any open question displays
            document.getElementById('questionOverlay').classList.remove('show');
            document.getElementById('questionDisplay').classList.remove('show');
            
            updateCurrentSettingsDisplay();
            
            // Reset action taken state for new turn
            gameState.actionTaken = false;
        }

        function updatePlayerNames() {
            const player1 = document.getElementById('player1Name').value.trim();
            const player2 = document.getElementById('player2Name').value.trim();
            
            if (!player1 || !player2) {
                showNotification('Please enter both player names!');
                return;
            }
            
            if (player1.toLowerCase() === player2.toLowerCase()) {
                showNotification('Please use different names!');
                return;
            }
            
            gameState.player1Name = player1;
            gameState.player2Name = player2;
            
            updateDisplay();
            saveGameState();
            showNotification('Player names updated!');
        }

        function getFilteredQuestion() {
            const availableQuestions = [];
            const levelQuestions = questionsDatabase[gameState.spiceLevel] || {};
            
            // Get questions from all categories not excluded
            Object.keys(levelQuestions).forEach(category => {
                if (!gameState.excludedCategories.includes(category)) {
                    availableQuestions.push(...levelQuestions[category]);
                }
            });
            
            // Fallback to general questions if no categories available
            if (availableQuestions.length === 0 && levelQuestions.general) {
                availableQuestions.push(...levelQuestions.general);
            }
            
            // Ultimate fallback
            if (availableQuestions.length === 0) {
                return "Will you ever make this night unforgettable?";
            }
            
            // Return random question
            const randomIndex = Math.floor(Math.random() * availableQuestions.length);
            return availableQuestions[randomIndex];
        }

        async function answerQuestion(answer) {
            if (gameState.questionAnswered) {
                return; // Prevent double-clicking
            }
            
            gameState.questionAnswered = true;
            gameState.questionAnswer = answer;
            
            const currentPlayerName = gameState.currentPlayer === 'Player1' ? gameState.player1Name : gameState.player2Name;
            
            // Hide question actions
            document.getElementById('questionActions').style.display = 'none';
            
            // Show result
            showQuestionResult(answer, false);
            
            // Log the answer to backend
            await logAction(currentPlayerName, 'Question', gameState.currentQuestion, answer);
            
            // Start auto-advance countdown after delay
            setTimeout(() => {
                // Close question display first
                document.getElementById('questionOverlay').classList.remove('show');
                document.getElementById('questionDisplay').classList.remove('show');
                
                // Then start countdown
                setTimeout(() => {
                    startAutoAdvanceCountdown();
                }, 300);
            }, 2000);
            
            // Trigger haptic feedback
            triggerHapticFeedback();
        }

        async function letFateDecide() {
            if (gameState.questionAnswered) {
                return; // Prevent double-clicking
            }
            
            // Add spinning animation
            const fateBtn = document.getElementById('fateDecideBtn');
            fateBtn.classList.add('spinning');
            fateBtn.disabled = true;
            
            // Wait for animation
            setTimeout(async () => {
                const choices = ['yes', 'no'];
                const fateAnswer = choices[Math.floor(Math.random() * choices.length)];
                
                gameState.questionAnswered = true;
                gameState.questionAnswer = fateAnswer;
                
                const currentPlayerName = gameState.currentPlayer === 'Player1' ? gameState.player1Name : gameState.player2Name;
                
                // Hide question actions
                document.getElementById('questionActions').style.display = 'none';
                
                // Show result
                showQuestionResult(fateAnswer, true);
                
                // Log the answer to backend
                await logAction(currentPlayerName, 'Question', gameState.currentQuestion, `fate-${fateAnswer}`);
                
                // Start auto-advance countdown after delay
                setTimeout(() => {
                    // Close question display first
                    document.getElementById('questionOverlay').classList.remove('show');
                    document.getElementById('questionDisplay').classList.remove('show');
                    
                    // Then start countdown
                    setTimeout(() => {
                        startAutoAdvanceCountdown();
                    }, 300);
                }, 2000);
                
                // Remove spinning animation
                fateBtn.classList.remove('spinning');
                fateBtn.disabled = false;
                
                // Trigger haptic feedback
                triggerHapticFeedback();
            }, 800);
        }

        function showQuestionResult(answer, wasFate = false) {
            const resultDiv = document.getElementById('questionResult');
            const resultIcon = document.getElementById('resultIcon');
            const resultMessage = document.getElementById('resultMessage');
            
            resultDiv.style.display = 'block';
            
            if (answer === 'yes') {
                resultDiv.className = 'question-result yes-result';
                resultIcon.textContent = wasFate ? 'üé≤üíã' : 'üíã';
                resultMessage.textContent = wasFate ? 'Fate says... Hell Yes!' : 'Hell Yes!';
            } else {
                resultDiv.className = 'question-result no-result';
                resultIcon.textContent = wasFate ? 'üé≤üòà' : 'üòà';
                resultMessage.textContent = wasFate ? 'Fate says... Not Tonight!' : 'Not Tonight!';
            }
            
            if (wasFate) {
                const fateMessages = {
                    yes: [
                        'The universe wants you to be bold!',
                        'Destiny has spoken... go for it!',
                        'Fate is feeling spicy tonight!',
                        'The stars align for adventure!'
                    ],
                    no: [
                        'Maybe save this one for later...',
                        'Fate suggests building more anticipation!',
                        'The universe says timing is everything!',
                        'Not tonight, but who knows what tomorrow brings!'
                    ]
                };
                
                const messages = fateMessages[answer];
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                
                setTimeout(() => {
                    resultMessage.textContent = randomMessage;
                }, 1500);
            }
        }

        async function nextTurn() {
            // Switch players
            gameState.currentPlayer = gameState.currentPlayer === 'Player1' ? 'Player2' : 'Player1';
            gameState.totalTurns++;
            
            // Reset turn states
            gameState.actionTaken = false;
            gameState.questionAnswered = false;
            gameState.currentQuestion = null;
            gameState.questionAnswer = null;
            
            // Update display
            updateDisplay();
            showNotification(`${gameState.currentPlayer === 'Player1' ? gameState.player1Name : gameState.player2Name}'s turn! Roll the dice!`);
            
            // Save state
            saveGameState();
        }

        // Backend Communication
        async function logAction(playerName, action, question = '', answer = '') {
            try {
                if (SCRIPT_URL && SCRIPT_URL !== 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                    await fetch(SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'logGameAction',
                            playerName: playerName,
                            gameAction: action,
                            question: question,
                            answer: answer,
                            spiceLevel: gameState.spiceLevel,
                            excludedCategories: gameState.excludedCategories,
                            sessionID: gameState.sessionID
                        })
                    });
                }
            } catch (error) {
                console.log('Could not log to backend:', error);
                // Continue without backend - app works offline
            }
        }

        async function saveUserPreferences() {
            try {
                if (SCRIPT_URL && SCRIPT_URL !== 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                    await fetch(SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'saveUserPreferences',
                            spiceLevel: gameState.spiceLevel,
                            excludedCategories: gameState.excludedCategories,
                            sessionID: gameState.sessionID
                        })
                    });
                }
            } catch (error) {
                console.log('Could not save preferences to backend:', error);
                // Continue without backend - preferences saved locally
            }
        }

        // Local Storage Functions
        function saveGameState() {
            try {
                // Only save persistent game state
                const stateToSave = {
                    currentPlayer: gameState.currentPlayer,
                    totalTurns: gameState.totalTurns,
                    player1Name: gameState.player1Name,
                    player2Name: gameState.player2Name,
                    spiceLevel: gameState.spiceLevel,
                    excludedCategories: gameState.excludedCategories,
                    sessionID: gameState.sessionID
                };
                localStorage.setItem('eroticDateNightGameState', JSON.stringify(stateToSave));
            } catch (error) {
                console.log('Could not save game state locally');
            }
        }

        function loadGameState() {
            try {
                const saved = localStorage.getItem('eroticDateNightGameState');
                const savedSettings = localStorage.getItem('eroticDateNightSettings');
                
                if (saved) {
                    const parsedState = JSON.parse(saved);
                    gameState.currentPlayer = parsedState.currentPlayer || 'Player1';
                    gameState.totalTurns = parsedState.totalTurns || 0;
                    gameState.player1Name = parsedState.player1Name || 'Player 1';
                    gameState.player2Name = parsedState.player2Name || 'Player 2';
                    gameState.spiceLevel = parsedState.spiceLevel || 2;
                    gameState.excludedCategories = parsedState.excludedCategories || ['taboo'];
                    gameState.sessionID = parsedState.sessionID || generateSessionID();
                }
                
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    gameState.spiceLevel = settings.spiceLevel || 2;
                    gameState.excludedCategories = settings.excludedCategories || ['taboo'];
                }
                
                // Always reset action states on load
                gameState.actionTaken = false;
                gameState.questionAnswered = false;
                gameState.isSpinning = false;
                
                console.log('Game state loaded');
                
            } catch (error) {
                console.log('Could not load saved data, using defaults');
            }
        }

        // Touch and Mobile Optimizations
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Prevent context menu on long press
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });

        // Add haptic feedback for supported devices
        function triggerHapticFeedback() {
            if ('vibrate' in navigator) {
                navigator.vibrate(50);
            }
        }

        // Add haptic feedback to button clicks
        document.addEventListener('click', function(e) {
            if (e.target.matches('.action-btn, .spice-level, .continue-btn, .answer-btn, .random-choice-btn, .play-button, .settings-btn')) {
                triggerHapticFeedback();
            }
        });

        // Performance monitoring
        if ('performance' in window) {
            window.addEventListener('load', function() {
                setTimeout(function() {
                    const loadTime = performance.now();
                    console.log(`App loaded in ${Math.round(loadTime)}ms`);
                }, 0);
            });
        }

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('App error:', e.error);
            // Only show error notification for actual errors, not navigation
            if (e.error && !e.error.message?.includes('ResizeObserver')) {
                // Silently log errors without showing notification
                console.log('Error logged:', e.error);
            }
        });

        // Network status monitoring
        if ('navigator' in window && 'onLine' in navigator) {
            function updateOnlineStatus() {
                if (!navigator.onLine) {
                    showNotification('Offline mode - app still works locally!');
                }
            }
            
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
        }
    </script>
</body>
</html>
