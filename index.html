</style>
</head>
<body>
    <!-- Player Setup Overlay -->
    <div class="settings-overlay" id="playerSetupOverlay">
        <div class="settings-modal">
            <h2 class="settings-title">Welcome to Erotic Date Nigh</h2>
            
            <div style="margin-bottom: 25px; text-align: center;">
                <p style="color: var(--cream); margin-bottom: 20px;">Enter your names to get started:</p>
                
                <div class="player-names-setup">
                    <input type="text" class="player-input" id="setupPlayer1Name" placeholder="Player 1 Name" maxlength="20">
                    <input type="text" class="player-input" id="setupPlayer2Name" placeholder="Player 2 Name" maxlength="20">
                </div>
            </div>
            
            <button class="continue-btn" onclick="savePlayerNamesAndContinue()">
                Continue to Game Settings
            </button>
        </div>
    </div>

    <!-- Settings Overlay -->
    <div class="settings-overlay hidden" id="settingsOverlay">
        <div class="settings-modal">
            <h2 class="settings-title">Choose Your Experience</h2>
            
            <div class="spice-selector">
                <div class="spice-level romantic" data-level="1" onclick="selectSpiceLevel(1)">
                    <div>üòä Romantic</div>
                    <div style="font-size: 0.8rem; margin-top: 5px; opacity: 0.8;">Sensual & Sweet</div>
                </div>
                <div class="spice-level spicy selected" data-level="2" onclick="selectSpiceLevel(2)">
                    <div>üî• Spicy</div>
                    <div style="font-size: 0.8rem; margin-top: 5px; opacity: 0.8;">Passionate & Bold</div>
                </div>
                <div class="spice-level intense" data-level="3" onclick="selectSpiceLevel(3)">
                    <div>üå∂Ô∏è Intense</div>
                    <div style="font-size: 0.8rem; margin-top: 5px; opacity: 0.8;">Kinky & Explicit</div>
                </div>
                <div class="spice-level extreme" data-level="4" onclick="selectSpiceLevel(4)">
                    <div>üî•üî• Extreme</div>
                    <div style="font-size: 0.8rem; margin-top: 5px; opacity: 0.8;">No Limits</div>
                </div>
            </div>
            
            <div class="exclusions-section">
                <div class="exclusions-title">Exclude These Topics:</div>
                
                <label class="exclusion-item" onclick="toggleExclusion(this)">
                    <input type="checkbox" class="exclusion-checkbox" data-category="bondage">
                    <span class="exclusion-label">üîó Bondage & BDSM</span>
                </label>
                
                <label class="exclusion-item" onclick="toggleExclusion(this)">
                    <input type="checkbox" class="exclusion-checkbox" data-category="public">
                    <span class="exclusion-label">üåç Public Activities</span>
                </label>
                
                <label class="exclusion-item" onclick="toggleExclusion(this)">
                    <input type="checkbox" class="exclusion-checkbox" data-category="roleplay">
                    <span class="exclusion-label">üé≠ Role Playing</span>
                </label>
                
                <label class="exclusion-item" onclick="toggleExclusion(this)">
                    <input type="checkbox" class="exclusion-checkbox" data-category="toys">
                    <span class="exclusion-label">üß∏ Toys & Accessories</span>
                </label>
                
                <label class="exclusion-item" onclick="toggleExclusion(this)">
                    <input type="checkbox" class="exclusion-checkbox" data-category="voyeur">
                    <span class="exclusion-label">üëÄ Watching & Recording</span>
                </label>
                
                <label class="exclusion-item" onclick="toggleExclusion(this)">
                    <input type="checkbox" class="exclusion-checkbox" data-category="taboo" checked>
                    <span class="exclusion-label">üö´ Taboo & Extreme</span>
                </label>
            </div>
            
            <button class="continue-btn" onclick="saveSettingsAndContinue()">
                Start Playing
            </button>
        </div>
    </div>

    <!-- Main App -->
    <div class="container">
        <div class="header">
            <h1 class="title">Erotic Date Nigh</h1>
            <p class="subtitle">A sophisticated game for adventurous couples</p>
        </div>

        <div class="current-settings" id="currentSettings">
            <span>Current Level: <strong>Spicy</strong></span>
            <button class="settings-btn" onclick="showSettings()">Change</button>
        </div>

        <div class="player-turn">
            <div class="current-player" id="currentPlayerDisplay">Player 1's Turn</div>
            <div class="turn-counter" id="turnCounter">Turn #1</div>
        </div>

        <div class="game-area">
            <div class="action-buttons">
                <button class="action-btn clothing" onclick="takeAction('Remove Clothing')" aria-label="Remove piece of clothing">
                    <span class="btn-emoji">üî•</span>
                    <span class="btn-text">Remove Clothing</span>
                </button>
                
                <button class="action-btn drink" onclick="takeAction('Take a Sip')" aria-label="Take a sip of drink">
                    <span class="btn-emoji">ü•Ç</span>
                    <span class="btn-text">Take a Sip</span>
                </button>
                
                <button class="action-btn shot" onclick="takeAction('Take a Shot')" aria-label="Take a shot">
                    <span class="btn-emoji">üç∏</span>
                    <span class="btn-text">Take a Shot</span>
                </button>
                
                <button class="action-btn question" onclick="takeAction('Question')" aria-label="Answer a spicy question">
                    <span class="btn-emoji">üíã</span>
                    <span class="btn-text">Will You Ever...</span>
                </button>
                
                <button class="action-btn fate" onclick="takeAction('Let Fate Decide')" aria-label="Let fate choose your action">
                    <span class="btn-emoji">üîÆ</span>
                    <span class="btn-text">Let Fate Decide</span>
                </button>
            </div>

            <div class="question-display" id="questionDisplay">
                <div class="question-title">Will You Ever...</div>
                <div class="question-text" id="questionText"></div>
                <div style="text-align: center; margin-top: 15px;">
                    <span class="question-intensity" id="questionIntensity"></span>
                </div>
                
                <div class="question-actions" id="questionActions">
                    <div class="answer-buttons">
                        <button class="answer-btn yes-btn" onclick="answerQuestion('yes')">
                            <span class="answer-emoji">üíã</span>
                            <span class="answer-text">Hell Yes!</span>
                        </button>
                        <button class="answer-btn no-btn" onclick="answerQuestion('no')">
                            <span class="answer-emoji">üòà</span>
                            <span class="answer-text">Not Tonight</span>
                        </button>
                    </div>
                </div>
                
                <div class="question-result" id="questionResult" style="display: none;">
                    <div class="result-icon" id="resultIcon"></div>
                    <div class="result-message" id="resultMessage"></div>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <h3 class="settings-title-main">Settings</h3>
            
            <div class="player-names-main">
                <input type="text" class="player-input-main" id="player1Name" placeholder="Player 1 Name" maxlength="20">
                <input type="text" class="player-input-main" id="player2Name" placeholder="Player 2 Name" maxlength="20">
            </div>
            
            <button class="submit-btn" onclick="updatePlayerNames()">Update Names</button>
            <button class="settings-btn" onclick="showSettings()" style="margin-left: 15px;">Change Game Settings</button>
        </div>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>Loading...</div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Configuration - REPLACE WITH YOUR ACTUAL GOOGLE APPS SCRIPT WEB APP URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzmH-KMHEc1xqs6PPORu7q5Y1eeA7PfQCuLl0DmZffhhW2maSDxZq_WiEBhjGafgl9T/exec';
        
        // Game State - CLEAN VERSION
        let gameState = {
            currentPlayer: 'Player1',
            totalTurns: 0,
            player1Name: 'Player 1',
            player2Name: 'Player 2',
            spiceLevel: 2,
            excludedCategories: ['taboo'],
            sessionID: generateSessionID()
            // REMOVED: actionTaken, questionAnswered, etc. - we'll handle these locally
        };

        // LOCAL action state (not saved to storage)
        let currentTurnState = {
            actionTaken: false,
            questionAnswered: false,
            currentQuestion: '',
            questionAnswer: ''
        };

        // Comprehensive Questions Database (organized by spice level and category)
        const questionsDatabase = {
            1: { // Romantic
                general: [
                    "Will you ever let me give you a sensual massage tonight?",
                    "Will you ever tell me what makes you feel most loved?",
                    "Will you ever dance with me in just our underwear?",
                    "Will you ever let me undress you slowly by candlelight?",
                    "Will you ever let me worship your body with kisses?",
                    "Will you ever write me a love letter describing your desires?"
                ],
                fantasy: [
                    "Will you ever share your most romantic fantasy with me?",
                    "Will you ever tell me about your dream romantic getaway?",
                    "Will you ever describe how you want to be seduced?"
                ]
            },
            2: { // Spicy  
                general: [
                    "Will you ever let me choose what you wear to bed tonight?",
                    "Will you ever try that position we talked about?",
                    "Will you ever tell me your secret turn-on?",
                    "Will you ever let me tease you until you can't take it?",
                    "Will you ever skinny dip with me tonight?",
                    "Will you ever let me wake you up with oral sex?",
                    "Will you ever have sex with me in the shower?",
                    "Will you ever let me see you completely naked in daylight?",
                    "Will you ever tell me what you want me to do to you right now?",
                    "Will you ever try making love without saying a word?"
                ],
                fantasy: [
                    "Will you ever tell me your dirtiest fantasy?",
                    "Will you ever share what you think about when you touch yourself?",
                    "Will you ever describe your perfect night of passion?"
                ],
                voyeur: [
                    "Will you ever let me watch you touch yourself?",
                    "Will you ever show me how you like to be touched?",
                    "Will you ever let me take photos of you in lingerie?",
                    "Will you ever send me a sexy photo when I'm at work?"
                ]
            },
            3: { // Intense
                general: [
                    "Will you ever try anal with me?",
                    "Will you ever let me tease you until you can't take it?",
                    "Will you ever try edging with me?",
                    "Will you ever let me use ice on your body?",
                    "Will you ever let me completely dominate you tonight?"
                ],
                bondage: [
                    "Will you ever let me tie your hands behind your back?",
                    "Will you ever let me blindfold you during foreplay?",
                    "Will you ever let me use handcuffs on you?",
                    "Will you ever try being completely submissive to me?",
                    "Will you ever let me spank you?",
                    "Will you ever let me control when you climax?"
                ],
                public: [
                    "Will you ever let me pleasure you in a public place?",
                    "Will you ever risk getting caught with me?",
                    "Will you ever try having sex in a risky location?",
                    "Will you ever have sex with me while others are nearby?"
                ],
                toys: [
                    "Will you ever use toys with me?",
                    "Will you ever let me control your pleasure with a toy?",
                    "Will you ever experiment with different toys together?"
                ],
                roleplay: [
                    "Will you ever role-play being strangers meeting for the first time?",
                    "Will you ever dress up in costume for me?",
                    "Will you ever pretend to be someone else in bed?"
                ],
                voyeur: [
                    "Will you ever let me record us (just for us)?",
                    "Will you ever moan my name while I watch you?",
                    "Will you ever perform for me like I'm your audience?"
                ]
            },
            4: { // Extreme  
                general: [
                    "Will you ever try something that pushes both our boundaries?",
                    "Will you ever explore your darkest desires with me?"
                ],
                bondage: [
                    "Will you ever try pain mixed with pleasure?",
                    "Will you ever experiment with power exchange scenarios?",
                    "Will you ever let me have complete control over your body?"
                ],
                toys: [
                    "Will you ever try double penetration with toys?",
                    "Will you ever experiment with extreme toys?"
                ],
                taboo: [
                    "Will you ever try taboo role-playing scenarios?",
                    "Will you ever explore forbidden fantasies with me?",
                    "Will you ever let me fulfill your most secret desire?"
                ]
            }
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            loadGameState();
            
            // Check if players have been set up
            if (!gameState.player1Name || gameState.player1Name === 'Player 1' || 
                !gameState.player2Name || gameState.player2Name === 'Player 2') {
                showPlayerSetup();
            } else if (!localStorage.getItem('eroticDateNighSettings')) {
                showSettings();
            } else {
                updateDisplay();
            }

            // Register service worker for PWA functionality
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('data:text/javascript,// Minimal service worker').catch(() => {
                    // Service worker registration failed - continue without PWA features
                });
            }
        });

        // Player Setup Functions
        function showPlayerSetup() {
            document.getElementById('playerSetupOverlay').classList.remove('hidden');
        }

        function savePlayerNamesAndContinue() {
            const player1 = document.getElementById('setupPlayer1Name').value.trim();
            const player2 = document.getElementById('setupPlayer2Name').value.trim();
            
            if (!player1 || !player2) {
                showNotification('Please enter both player names!');
                return;
            }
            
            if (player1.toLowerCase() === player2.toLowerCase()) {
                showNotification('Please use different names!');
                return;
            }
            
            gameState.player1Name = player1;
            gameState.player2Name = player2;
            
            // Hide player setup
            document.getElementById('playerSetupOverlay').classList.add('hidden');
            
            // Show settings if not already configured
            if (!localStorage.getItem('eroticDateNighSettings')) {
                showSettings();
            } else {
                updateDisplay();
                showNotification(`Welcome ${player1} and ${player2}! Have fun!`);
            }
            
            saveGameState();
        }

        // Utility Functions
        function generateSessionID() {
            return 'session_' + Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function showLoading(show = true) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.add('show');
            } else {
                loading.classList.remove('show');
            }
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Settings Functions
        function selectSpiceLevel(level) {
            gameState.spiceLevel = level;
            
            // Update visual selection
            document.querySelectorAll('.spice-level').forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelector(`[data-level="${level}"]`).classList.add('selected');
        }

        function toggleExclusion(labelElement) {
            // Prevent double-firing from both label and checkbox
            setTimeout(() => {
                const checkbox = labelElement.querySelector('.exclusion-checkbox');
                if (checkbox) {
                    labelElement.style.background = checkbox.checked ? 
                        'rgba(255, 255, 255, 0.15)' : 
                        'rgba(255, 255, 255, 0.05)';
                }
            }, 10);
        }

        function showSettings() {
            document.getElementById('settingsOverlay').classList.remove('hidden');
            
            // Update current selections
            document.querySelector(`[data-level="${gameState.spiceLevel}"]`).classList.add('selected');
            
            // Update exclusion checkboxes
            gameState.excludedCategories.forEach(category => {
                const checkbox = document.querySelector(`[data-category="${category}"]`);
                if (checkbox) {
                    checkbox.checked = true;
                    checkbox.closest('.exclusion-item').style.background = 'rgba(255, 255, 255, 0.15)';
                }
            });
        }

        function saveSettingsAndContinue() {
            // Get excluded categories
            const excludedCategories = [];
            document.querySelectorAll('.exclusion-checkbox:checked').forEach(checkbox => {
                excludedCategories.push(checkbox.dataset.category);
            });
            
            gameState.excludedCategories = excludedCategories;
            
            // Save to localStorage
            localStorage.setItem('eroticDateNighSettings', JSON.stringify({
                spiceLevel: gameState.spiceLevel,
                excludedCategories: gameState.excludedCategories
            }));
            
            // Save preferences to backend if connected
            saveUserPreferences();
            
            // Hide overlay and update display
            document.getElementById('settingsOverlay').classList.add('hidden');
            updateCurrentSettingsDisplay();
            updateDisplay();
            
            showNotification('Settings saved! Enjoy your customized experience.');
        }

        function updateCurrentSettingsDisplay() {
            const levels = {1: 'Romantic', 2: 'Spicy', 3: 'Intense', 4: 'Extreme'};
            const levelName = levels[gameState.spiceLevel];
            
            document.getElementById('currentSettings').innerHTML = `
                <span>Current Level: <strong>${levelName}</strong></span>
                <button class="settings-btn" onclick="showSettings()">Change</button>
            `;
        }

        // Game Functions
        function updateDisplay() {
            const currentPlayerName = gameState.currentPlayer === 'Player1' ? gameState.player1Name : gameState.player2Name;
            document.getElementById('currentPlayerDisplay').textContent = currentPlayerName + "'s Turn";
            document.getElementById('turnCounter').textContent = `Turn #${gameState.totalTurns + 1}`;
            
            // Update player name inputs in settings
            document.getElementById('player1Name').value = gameState.player1Name;
            document.getElementById('player2Name').value = gameState.player2Name;
            
            // Hide any open question displays
            document.getElementById('questionDisplay').classList.remove('show');
            
            updateCurrentSettingsDisplay();
        }

        // Local Storage Functions - DON'T save action state
        function saveGameState() {
            try {
                // Only save persistent game state, NOT current turn state
                const stateToSave = {
                    currentPlayer: gameState.currentPlayer,
                    totalTurns: gameState.totalTurns,
                    player1Name: gameState.player1Name,
                    player2Name: gameState.player2Name,
                    spiceLevel: gameState.spiceLevel,
                    excludedCategories: gameState.excludedCategories,
                    sessionID: gameState.sessionID
                };
                localStorage.setItem('eroticDateNighGameState', JSON.stringify(stateToSave));
            } catch (error) {
                console.log('Could not save game state locally');
            }
        }

        function loadGameState() {
            try {
                const saved = localStorage.getItem('eroticDateNighGameState');
                const savedSettings = localStorage.getItem('eroticDateNighSettings');
                
                if (saved) {
                    const parsedState = JSON.parse(saved);
                    // Only restore persistent state
                    gameState.currentPlayer = parsedState.currentPlayer || 'Player1';
                    gameState.totalTurns = parsedState.totalTurns || 0;
                    gameState.player1Name = parsedState.player1Name || 'Player 1';
                    gameState.player2Name = parsedState.player2Name || 'Player 2';
                    gameState.spiceLevel = parsedState.spiceLevel || 2;
                    gameState.excludedCategories = parsedState.excludedCategories || ['taboo'];
                    gameState.sessionID = parsedState.sessionID || generateSessionID();
                }
                
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    gameState.spiceLevel = settings.spiceLevel || 2;
                    gameState.excludedCategories = settings.excludedCategories || ['taboo'];
                }
                
                // ALWAYS reset turn state on load
                currentTurnState = {
                    actionTaken: false,
                    questionAnswered: false,
                    currentQuestion: '',
                    questionAnswer: ''
                };
                
                console.log('Game state loaded, turn state reset');
                
            } catch (error) {
                console.log('Could not load saved data, using defaults');
            }
        }

        function getFilteredQuestion() {
            const availableQuestions = [];
            const levelQuestions = questionsDatabase[gameState.spiceLevel] || {};
            
            // Get questions from all categories not excluded
            Object.keys(levelQuestions).forEach(category => {
                if (!gameState.excludedCategories.includes(category)) {
                    availableQuestions.push(...levelQuestions[category]);
                }
            });
            
            // Fallback to general questions if no categories available
            if (availableQuestions.length === 0 && levelQuestions.general) {
                availableQuestions.push(...levelQuestions.general);
            }
            
            // Ultimate fallback
            if (availableQuestions.length === 0) {
                return "Will you ever make this night unforgettable?";
            }
            
            // Return random question
            const randomIndex = Math.floor(Math.random() * availableQuestions.length);
            return availableQuestions[randomIndex];
        }

        async function takeAction(action) {
            if (gameState.actionTaken) {
                showNotification('Already took an action this turn!');
                return;
            }

            gameState.actionTaken = true;
            gameState.lastAction = action;
            
            const currentPlayerName = gameState.currentPlayer === 'Player1' ? gameState.player1Name : gameState.player2Name;
            
            if (action === 'Question') {
                const question = getFilteredQuestion();
                gameState.currentQuestion = question;
                const levels = {1: 'Romantic', 2: 'Spicy', 3: 'Intense', 4: 'Extreme'};
                
                document.getElementById('questionText').textContent = question;
                document.getElementById('questionIntensity').textContent = levels[gameState.spiceLevel];
                document.getElementById('questionDisplay').classList.add('show');
                
                // Show the question actions
                document.getElementById('questionActions').style.display = 'block';
                document.getElementById('questionResult').style.display = 'none';
                
                showNotification(`${currentPlayerName}, will you answer this ${levels[gameState.spiceLevel].toLowerCase()} question?`);
                
                // Don't enable next turn until question is answered
                document.getElementById('nextTurnBtn').disabled = true;
            } else {
                showNotification(`${currentPlayerName} chose: ${action}`);
                await logAction(currentPlayerName, action);
                
                // Enable next turn button for non-question actions
                const nextBtn = document.getElementById('nextTurnBtn');
                nextBtn.disabled = false;
                nextBtn.classList.add('pulse');
            }
        }

        async function answerQuestion(answer) {
            if (gameState.questionAnswered) {
                return; // Prevent double-clicking
            }
            
            gameState.questionAnswered = true;
            gameState.questionAnswer = answer;
            
            const currentPlayerName = gameState.currentPlayer === 'Player1' ? gameState.player1Name : gameState.player2Name;
            
            // Hide question actions
            document.getElementById('questionActions').style.display = 'none';
            
            // Show result
            showQuestionResult(answer, false);
            
            // Log the answer to backend
            await logAction(currentPlayerName, 'Question', gameState.currentQuestion, answer);
            
            // Enable next turn button
            const nextBtn = document.getElementById('nextTurnBtn');
            nextBtn.disabled = false;
            nextBtn.classList.add('pulse');
            
            // Trigger haptic feedback
            triggerHapticFeedback();
        }

        async function letFateDecide() {
            if (gameState.questionAnswered) {
                return; // Prevent double-clicking
            }
            
            // Add spinning animation
            const fateBtn = document.getElementById('fateDecideBtn');
            fateBtn.classList.add('spinning');
            fateBtn.disabled = true;
            
            // Wait for animation
            setTimeout(async () => {
                const choices = ['yes', 'no'];
                const fateAnswer = choices[Math.floor(Math.random() * choices.length)];
                
                gameState.questionAnswered = true;
                gameState.questionAnswer = fateAnswer;
                
                const currentPlayerName = gameState.currentPlayer === 'Player1' ? gameState.player1Name : gameState.player2Name;
                
                // Hide question actions
                document.getElementById('questionActions').style.display = 'none';
                
                // Show result
                showQuestionResult(fateAnswer, true);
                
                // Log the answer to backend
                await logAction(currentPlayerName, 'Question', gameState.currentQuestion, `fate-${fateAnswer}`);
                
                // Enable next turn button
                const nextBtn = document.getElementById('nextTurnBtn');
                nextBtn.disabled = false;
                nextBtn.classList.add('pulse');
                
                // Remove spinning animation
                fateBtn.classList.remove('spinning');
                fateBtn.disabled = false;
                
                // Trigger haptic feedback
                triggerHapticFeedback();
            }, 800);
        }

        function showQuestionResult(answer, wasFate = false) {
            const resultDiv = document.getElementById('questionResult');
            const resultIcon = document.getElementById('resultIcon');
            const resultMessage = document.getElementById('resultMessage');
            
            resultDiv.style.display = 'block';
            
            if (answer === 'yes') {
                resultDiv.className = 'question-result yes-result';
                resultIcon.textContent = wasFate ? 'üé≤üíã' : 'üíã';
                resultMessage.textContent = wasFate ? 'Fate says... Hell Yes!' : 'Hell Yes!';
            } else {
                resultDiv.className = 'question-result no-result';
                resultIcon.textContent = wasFate ? 'üé≤üòà' : 'üòà';
                resultMessage.textContent = wasFate ? 'Fate says... Not Tonight!' : 'Not Tonight!';
            }
            
            if (wasFate) {
                const fateMessages = {
                    yes: [
                        'The universe wants you to be bold!',
                        'Destiny has spoken... go for it!',
                        'Fate is feeling spicy tonight!',
                        'The stars align for adventure!'
                    ],
                    no: [
                        'Maybe save this one for later...',
                        'Fate suggests building more anticipation!',
                        'The universe says timing is everything!',
                        'Not tonight, but who knows what tomorrow brings!'
                    ]
                };
                
                const messages = fateMessages[answer];
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                
                setTimeout(() => {
                    resultMessage.textContent = randomMessage;
                }, 1500);
            }
        }

        async function nextTurn() {
            if (!gameState.actionTaken) {
                showNotification('Take an action first!');
                return;
            }
            
            // Switch players
            gameState.currentPlayer = gameState.currentPlayer === 'Player1' ? 'Player2' : 'Player1';
            gameState.totalTurns++;
            
            // Update display
            updateDisplay();
            showNotification('Turn switched!');
            
            // Save state
            saveGameState();
        }

        // Backend Communication
        async function logAction(playerName, action, question = '', answer = '') {
            try {
                if (SCRIPT_URL && SCRIPT_URL !== 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                    await fetch(SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'logGameAction',
                            playerName: playerName,
                            gameAction: action,
                            question: question,
                            answer: answer,
                            spiceLevel: gameState.spiceLevel,
                            excludedCategories: gameState.excludedCategories,
                            sessionID: gameState.sessionID
                        })
                    });
                }
            } catch (error) {
                console.log('Could not log to backend:', error);
                // Continue without backend - app works offline
            }
        }

        async function saveUserPreferences() {
            try {
                if (SCRIPT_URL && SCRIPT_URL !== 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                    await fetch(SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'saveUserPreferences',
                            spiceLevel: gameState.spiceLevel,
                            excludedCategories: gameState.excludedCategories,
                            sessionID: gameState.sessionID
                        })
                    });
                }
            } catch (error) {
                console.log('Could not save preferences to backend:', error);
                // Continue without backend - preferences saved locally
            }
        }

        // Local Storage Functions
        function saveGameState() {
            try {
                localStorage.setItem('eroticDateNighGameState', JSON.stringify(gameState));
            } catch (error) {
                console.log('Could not save game state locally');
            }
        }

        function loadGameState() {
            try {
                const saved = localStorage.getItem('eroticDateNighGameState');
                const savedSettings = localStorage.getItem('eroticDateNighSettings');
                
                if (saved) {
                    const parsedState = JSON.parse(saved);
                    gameState = { ...gameState, ...parsedState };
                }
                
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    gameState.spiceLevel = settings.spiceLevel || 2;
                    gameState.excludedCategories = settings.excludedCategories || ['taboo'];
                }
                
                // Ensure session ID exists
                if (!gameState.sessionID) {
                    gameState.sessionID = generateSessionID();
                }
            } catch (error) {
                console.log('Could not load saved data');
                // Use default state
            }
        }

        // Touch and Mobile Optimizations
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Prevent context menu on long press
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });

        // Add haptic feedback for supported devices
        function triggerHapticFeedback() {
            if ('vibrate' in navigator) {
                navigator.vibrate(50);
            }
        }

        // Add haptic feedback to button clicks
        document.addEventListener('click', function(e) {
            if (e.target.matches('.action-btn, .spice-level, .continue-btn, .next-turn-btn, .answer-btn, .random-choice-btn')) {
                triggerHapticFeedback();
            }
        });

        // Performance monitoring
        if ('performance' in window) {
            window.addEventListener('load', function() {
                setTimeout(function() {
                    const loadTime = performance.now();
                    console.log(`App loaded in ${Math.round(loadTime)}ms`);
                }, 0);
            });
        }

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('App error:', e.error);
            showNotification('Something went wrong, but the app should still work!');
        });

        // Network status monitoring
        if ('navigator' in window && 'onLine' in navigator) {
            function updateOnlineStatus() {
                if (!navigator.onLine) {
                    showNotification('Offline mode - app still works locally!');
                }
            }
            
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
        }
    </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Erotic Date Nigh</title>
    <meta name="description" content="A sophisticated intimate game for adventurous couples">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Source+Sans+Pro:wght@300;400;600&display=swap" rel="stylesheet">
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="data:application/json,{
        &quot;name&quot;: &quot;Erotic Date Nigh&quot;,
        &quot;short_name&quot;: &quot;Date Nigh&quot;,
        &quot;description&quot;: &quot;Sophisticated couples game&quot;,
        &quot;start_url&quot;: &quot;.&quot;,
        &quot;display&quot;: &quot;standalone&quot;,
        &quot;background_color&quot;: &quot;#0a0a0a&quot;,
        &quot;theme_color&quot;: &quot;#d4af37&quot;,
        &quot;icons&quot;: [
            {&quot;src&quot;: &quot;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Crect width='192' height='192' fill='%23d4af37'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='72' fill='%23000'%3Eüî•%3C/text%3E%3C/svg%3E&quot;, &quot;sizes&quot;: &quot;192x192&quot;, &quot;type&quot;: &quot;image/svg+xml&quot;}
        ]
    }">
    
    <style>
        :root {
            --gold: #d4af37;
            --deep-red: #8b0000;
            --burgundy: #722f37;
            --cream: #f5f5dc;
            --black: #0a0a0a;
            --dark-grey: #1a1a1a;
            --medium-grey: #2a2a2a;
            --transparent-gold: rgba(212, 175, 55, 0.1);
            --shadow-gold: 0 0 30px rgba(212, 175, 55, 0.3);
            --shadow-deep: 0 8px 40px rgba(0, 0, 0, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Source Sans Pro', sans-serif;
            background: linear-gradient(135deg, var(--black), var(--dark-grey), var(--burgundy));
            background-attachment: fixed;
            min-height: 100vh;
            max-height: 100vh;
            color: var(--cream);
            overflow-x: hidden;
            overflow-y: auto;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .container {
            max-width: 420px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            max-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-y: auto;
            box-sizing: border-box;
        }

        /* Settings Overlay */
        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease-out;
        }

        .settings-overlay.hidden {
            display: none;
        }

        .settings-modal {
            background: linear-gradient(135deg, var(--dark-grey), var(--medium-grey));
            border-radius: 25px;
            padding: 20px;
            max-width: 380px;
            width: 95%;
            max-height: 85vh;
            overflow-y: auto;
            border: 2px solid var(--gold);
            box-shadow: var(--shadow-deep);
            animation: slideUp 0.5s ease-out;
        }

        .settings-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.6rem;
            color: var(--gold);
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .spice-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .spice-level {
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.8rem;
            position: relative;
            overflow: hidden;
        }

        .spice-level::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s ease;
        }

        .spice-level:hover::before {
            left: 100%;
        }

        .spice-level.romantic {
            background: linear-gradient(135deg, #4a90e2, #7b68ee);
        }

        .spice-level.spicy {
            background: linear-gradient(135deg, #ff6b9d, #ff8a80);
        }

        .spice-level.intense {
            background: linear-gradient(135deg, #ff4757, #c44569);
        }

        .spice-level.extreme {
            background: linear-gradient(135deg, var(--deep-red), #000);
        }

        .spice-level.selected {
            border-color: var(--gold);
            box-shadow: var(--shadow-gold);
            transform: scale(1.05);
        }

        .player-names-setup {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .player-input {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid var(--gold);
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: var(--cream);
            font-size: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .player-input:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
            background: rgba(255, 255, 255, 0.15);
        }

        .player-input::placeholder {
            color: rgba(245, 245, 220, 0.6);
        }

        .exclusions-title {
            font-size: 1.2rem;
            color: var(--gold);
            margin-bottom: 15px;
            text-align: center;
            font-family: 'Cormorant Garamond', serif;
        }

        .exclusion-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            transition: background 0.3s ease;
            cursor: pointer;
        }

        .exclusion-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .exclusion-checkbox {
            width: 18px;
            height: 18px;
            accent-color: var(--gold);
            cursor: pointer;
        }

        .exclusion-label {
            flex: 1;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .continue-btn {
            background: linear-gradient(135deg, var(--gold), #f4e4bc);
            color: var(--black);
            border: none;
            border-radius: 15px;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .continue-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }

        .continue-btn:hover::before {
            left: 100%;
        }

        .continue-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-gold);
        }

        /* Main App Styles */
        .header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInDown 1s ease-out;
        }

        .title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--gold);
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.7);
            letter-spacing: 1px;
        }

        .subtitle {
            font-size: 1rem;
            color: var(--cream);
            opacity: 0.8;
            font-style: italic;
        }

        .current-settings {
            background: var(--transparent-gold);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            margin-bottom: 25px;
            font-size: 0.9rem;
        }

        .settings-btn {
            background: none;
            border: 1px solid var(--gold);
            color: var(--gold);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            background: var(--gold);
            color: var(--black);
            transform: translateY(-1px);
        }

        .player-turn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .player-turn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .current-player {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--gold);
        }

        .turn-counter {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .action-btn.fate {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #8a2be2, #4b0082);
        }

        .action-btn {
            border: none;
            border-radius: 20px;
            padding: 20px 15px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            min-height: 100px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .action-btn:active {
            transform: translateY(-1px);
        }

        .action-btn.clothing {
            background: linear-gradient(135deg, #ff6b9d, #ff8a80);
        }

        .action-btn.drink {
            background: linear-gradient(135deg, #4fc3f7, #29b6f6);
        }

        .action-btn.shot {
            background: linear-gradient(135deg, #ba68c8, #ab47bc);
        }

        .action-btn.question {
            background: linear-gradient(135deg, var(--gold), #f4e4bc);
            color: var(--black);
        }

        .btn-emoji {
            font-size: 2rem;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .btn-text {
            font-size: 0.9rem;
            text-align: center;
            line-height: 1.2;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .question-display {
            background: rgba(212, 175, 55, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            display: none;
            animation: slideUp 0.5s ease-out;
            position: relative;
        }

        .question-display.show {
            display: block;
        }

        .question-display::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(212, 175, 55, 0.05), transparent);
            animation: rotate 8s linear infinite;
            z-index: -1;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .question-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
            color: var(--gold);
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .question-text {
            font-size: 1.1rem;
            line-height: 1.4;
            text-align: center;
            font-style: italic;
            margin-bottom: 15px;
        }

        .question-intensity {
            display: inline-block;
            background: var(--gold);
            color: var(--black);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .question-actions {
            margin-top: 25px;
            animation: fadeInUp 0.5s ease-out 0.3s both;
        }

        .answer-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .answer-btn {
            flex: 1;
            max-width: 140px;
            background: none;
            border: 2px solid var(--gold);
            border-radius: 20px;
            padding: 15px 10px;
            color: var(--gold);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .answer-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gold);
            transition: left 0.3s ease;
            z-index: -1;
        }

        .answer-btn:hover::before {
            left: 0;
        }

        .answer-btn:hover {
            color: var(--black);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.4);
        }

        .yes-btn:hover {
            border-color: #4CAF50;
        }

        .yes-btn:hover::before {
            background: #4CAF50;
        }

        .no-btn:hover {
            border-color: #ff4757;
        }

        .no-btn:hover::before {
            background: #ff4757;
        }

        .answer-emoji {
            font-size: 1.5rem;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .answer-text {
            font-size: 0.9rem;
            text-align: center;
            line-height: 1.2;
        }

        .random-choice-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--burgundy), var(--deep-red));
            border: none;
            border-radius: 15px;
            padding: 12px 20px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .random-choice-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .random-choice-btn:hover::before {
            left: 100%;
        }

        .random-choice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 0, 0, 0.4);
        }

        .random-choice-btn.spinning {
            animation: spin 0.8s ease-in-out;
        }

        .random-emoji {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .random-choice-btn:hover .random-emoji {
            transform: rotate(360deg);
        }

        .random-text {
            font-size: 0.9rem;
        }

        .question-result {
            text-align: center;
            padding: 20px;
            margin-top: 15px;
            border-radius: 15px;
            animation: resultSlide 0.6s ease-out;
        }

        .question-result.yes-result {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .question-result.no-result {
            background: rgba(255, 71, 87, 0.1);
            border: 1px solid rgba(255, 71, 87, 0.3);
        }

        .question-result.random-result {
            background: rgba(186, 104, 200, 0.1);
            border: 1px solid rgba(186, 104, 200, 0.3);
        }

        .result-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            animation: bounce 0.6s ease-out;
        }

        .result-message {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--cream);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes resultSlide {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: scale(1);
            }
            40%, 43% {
                transform: scale(1.1);
            }
            70% {
                transform: scale(1.05);
            }
            90% {
                transform: scale(1.02);
            }
        }

        .next-turn-btn {
            background: linear-gradient(135deg, var(--deep-red), var(--burgundy));
            border: none;
            border-radius: 15px;
            padding: 15px 30px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: auto;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .next-turn-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .next-turn-btn:hover::before {
            left: 100%;
        }

        .next-turn-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 0, 0, 0.4);
        }

        .next-turn-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .next-turn-btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        .next-turn-btn:disabled::before {
            display: none;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 8px 20px rgba(139, 0, 0, 0.4); }
            50% { box-shadow: 0 8px 30px rgba(139, 0, 0, 0.8); }
            100% { box-shadow: 0 8px 20px rgba(139, 0, 0, 0.4); }
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            z-index: 999;
            display: none;
            border: 1px solid var(--gold);
            box-shadow: var(--shadow-deep);
            max-width: 90%;
            text-align: center;
        }

        .notification.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            z-index: 1001;
            display: none;
            border: 1px solid var(--gold);
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(212, 175, 55, 0.3);
            border-radius: 50%;
            border-top-color: var(--gold);
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateX(-50%) translateY(-10px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .container { 
                padding: 15px; 
            }
            
            .title { 
                font-size: 2.2rem; 
            }
            
            .spice-selector { 
                grid-template-columns: 1fr; 
                gap: 10px;
            }
            
            .spice-level {
                padding: 12px;
                font-size: 0.85rem;
            }
            
            .action-btn { 
                padding: 15px 10px; 
                min-height: 80px; 
            }
            
            .btn-emoji { 
                font-size: 1.5rem; 
            }
            
            .btn-text {
                font-size: 0.8rem;
            }

            .settings-modal {
                padding: 25px;
                margin: 10px;
            }

            .exclusion-item {
                padding: 10px;
                margin-bottom: 8px;
            }
        }

        @media (max-width: 360px) {
            .title { 
                font-size: 2rem; 
            }
            
            .action-buttons { 
                gap: 12px; 
            }

            .settings-title {
                font-size: 1.7rem;
            }

            .exclusion-label {
                font-size: 0.85rem;
            }
        }

        /* Performance optimizations */
        .action-btn, .spice-level, .continue-btn, .next-turn-btn {
            will-change: transform;
        }

        /* Accessibility improvements */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Touch improvements for mobile */
        .action-btn, .spice-level, .continue-btn, .settings-btn, .exclusion-item {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        /* Prevent zoom on input focus (iOS) */
        input, textarea, select {
            font-size: 16px;
        }
